"use strict";const doc=document.body,themeBtns=document.querySelectorAll(".theme_selector__btn"),bgBtns=document.querySelectorAll(".bg_color_selector__lbl"),images=document.querySelectorAll("picture"),themes=[{color1:"#f6da73",color2:"#3e5336",color3:"#e55b7e",font:"theme1_font",baseFontSize:"16"},{color1:"#e4eaea",color2:"#141a13",color3:"#ae621f",font:"theme2_font",baseFontSize:"16"},{color1:"#f4f6ec",color2:"#2d0c03",color3:"#f8b786",font:"theme3_font",baseFontSize:"16"}];function themeReset(e){doc.style.setProperty("--color",themes[e].color1),doc.style.setProperty("--background_color",themes[e].color2),doc.style.setProperty("--decor_color",themes[e].color3),doc.style.setProperty("--font_family",themes[e].font),doc.style.setProperty("--base_font_size",`${themes[e].baseFontSize}px`)}function bgReset(e){doc.style.setProperty("--fs_bg_color",`${1+18*e.target.value}%`)}themeBtns.forEach((e,t)=>{e.style.setProperty("color",themes[t].color1),e.style.setProperty("background-color",themes[t].color2),e.style.setProperty("border-color",themes[t].color3),e.style.setProperty("font-family",themes[t].font),e.style.setProperty("font-size",`${themes[t].baseFontSize-1}px`),e.addEventListener("click",()=>themeReset(t))}),bgBtns.forEach((e,t)=>{e.style.setProperty("background-color",`hsl(0, 0%, ${1+18*e.previousElementSibling.value}%)`)}),document.forms.bgSelect.addEventListener("input",bgReset);let showEXIF=!1;function EXIFCheckboxHandler(e){showEXIF=!!e.target.checked}document.getElementById("exif_option").addEventListener("change",EXIFCheckboxHandler);let currImg,fullscreenBack=document.createElement("div"),fullscreenImg=document.createElement("img");function fullscreenIn(){fullscreenBack.classList.add("fullscreen_back"),doc.classList.add("no_scroll"),doc.append(fullscreenBack),fullscreenBack.addEventListener("mousedown",fsMouseHandler),fullscreenBack.addEventListener("wheel",wheelHandler),window.addEventListener("keydown",fsKeyHandler)}function galleryFocusHandler(e){let l;e.target.addEventListener("keydown",function e(t){32!=t.keyCode&&"Enter"!=t.key||(l=new Event("click"),t.target.removeEventListener("keydown",e),t.target.parentElement.dispatchEvent(l))})}function galleryClickHandler(e){"PICTURE"===e.currentTarget.tagName&&(currImg=e.currentTarget,fullscreenIn(),showImage(currImg))}images.forEach((e,t)=>{e.addEventListener("click",galleryClickHandler),e.childNodes[5].addEventListener("focus",galleryFocusHandler)}),doc.addEventListener("wheel",e=>{e.ctrlKey&&(e.preventDefault(),e.stopPropagation())});let firstX,firstY,lastX,lastY,eventTouchToMouse;function wheelHandler(e){e.preventDefault(),e.stopPropagation(),(e.ctrlKey?0<e.deltaY?zoomIn:zoomOut:0<e.deltaY?nextImg:prevImg)()}let scaleFactor=1;const minScale=.5,maxScale=4;function zoomIn(){scaleFactor+=.1,scaleFactor>maxScale&&(scaleFactor=maxScale),1<scaleFactor&&(fullscreenBack.classList.add("fullscreen_back_fs"),fullscreenImg.classList.add("fullscreen_img-zoom")),fullscreenImg.style.transform=`scale(${scaleFactor})`}function zoomOut(){scaleFactor-=.1,scaleFactor<minScale&&(scaleFactor=minScale),scaleFactor<1&&(fullscreenBack.classList.remove("fullscreen_back_fs"),fullscreenImg.classList.remove("fullscreen_img-zoom")),fullscreenImg.style.transform=`scale(${scaleFactor})`}function fsTouchHandler(e){function l(e){e.preventDefault(),e.stopPropagation()}e.preventDefault(),e.stopPropagation(),eventTouchToMouse=new Event("mousedown"),eventTouchToMouse.clientX=e.targetTouches[0].clientX,fullscreenBack.dispatchEvent(eventTouchToMouse),fullscreenImg.addEventListener("touchend",function e(t){t.preventDefault();t.stopPropagation();eventTouchToMouse=new Event("mouseup");eventTouchToMouse.clientX=t.changedTouches[0].clientX;fullscreenBack.dispatchEvent(eventTouchToMouse);fullscreenImg.removeEventListener("touchend",e);fullscreenImg.removeEventListener("touchmove",l)})}function fsMouseHandler(e){firstX=e.clientX,firstY=e.clientY,firstX>fullscreenBack.clientWidth||firstY>fullscreenBack.clientHeight||fullscreenBack.addEventListener("mouseup",function e(t){fullscreenBack.removeEventListener("mouseup",e);lastX=t.clientX;lastY=t.clientY;20<lastX-firstX?nextImg():20<firstX-lastX?prevImg():(firstX-lastX<20||lastX-firstX<20)&&fullscreenEsc()})}function fsKeyHandler(e){"Escape"==e.key?fullscreenEsc():107==e.keyCode?zoomIn():109==e.keyCode?zoomOut():"ArrowLeft"==e.key||"ArrowUp"==e.key||"PageUp"==e.key?prevImg():"ArrowRight"!=e.key&&"ArrowDown"!=e.key&&"PageDown"!=e.key||nextImg()}function fullscreenEsc(){normalScale(),hideImage(),fullscreenOut()}function fullscreenOut(){fullscreenBack.classList.remove("fullscreen_back"),doc.classList.remove("no_scroll"),fullscreenBack.removeEventListener("mousedown",fsMouseHandler),fullscreenBack.removeEventListener("wheel",wheelHandler),window.removeEventListener("keydown",fsKeyHandler),fullscreenBack.remove()}function normalScale(){scaleFactor=1,fullscreenImg.style.transform="scale(1)",fullscreenBack.classList.remove("fullscreen_back_fs"),fullscreenImg.classList.remove("fullscreen_img-zoom")}function nextImg(){normalScale(),currImg=currImg.nextElementSibling||images[0],fullscreenImg.setAttribute("src",""),fullscreenImg.remove(),setTimeout(()=>{showImage(currImg)},60)}function prevImg(){normalScale(),currImg=currImg.previousElementSibling||images[images.length-1],fullscreenImg.setAttribute("src",""),fullscreenImg.remove(),setTimeout(()=>{showImage(currImg)},60)}function showImage(e){fullscreenImg.classList.add("fullscreen_img"),fullscreenImg.setAttribute("src",e.childNodes[5].currentSrc.replace("build/img","build/img/fullsize")),fullscreenBack.append(fullscreenImg),fullscreenImg.addEventListener("dragstart",e=>{e.preventDefault()}),fullscreenImg.addEventListener("touchstart",fsTouchHandler),fullscreenImg.addEventListener("click",e=>{e.preventDefault()}),showEXIF&&getExif(e.childNodes[5])}function hideImage(){fullscreenImg.classList.remove("fullscreen_img"),fullscreenImg.removeEventListener("touchstart",fsTouchHandler),showEXIF&&exifInfo.remove(),fullscreenImg.setAttribute("src",""),fullscreenImg.remove()}let exifInfo=document.createElement("div");function getExif(e){let t;EXIF.getData(e,function(){t=Boolean(EXIF.getTag(this,"Make"))?`Камера ${EXIF.getTag(this,"Make")} ${EXIF.getTag(this,"Model")}, дата и время: ${EXIF.getTag(this,"DateTime")}, ISO ${EXIF.getTag(this,"ISOSpeedRatings")}, выдержка 1/${Math.round(1/EXIF.getTag(this,"ExposureTime"))}, диафрагма 
${EXIF.getTag(this,"FNumber")}`:"нет данных",exifInfo.innerHTML=t,fullscreenBack.append(exifInfo)})}exifInfo.classList.add("fs_exif_info");